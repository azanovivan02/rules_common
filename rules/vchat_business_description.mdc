# VVChat Project Architecture & Constraints

## Core Strategy
VVChat is a multi-tenant LLM chat application that allows users to converse with AI and create custom, access-controlled "spaces" configured with specific system prompts and RAG over attached documents. The application features a custom React Single Page Application (Vite, TailwindCSS, shadcn, wouter, Zustand, Tanstack Query) that embeds a Chainlit chat client. The backend is powered by FastAPI and a Chainlit server, utilizing PostgreSQL for relational data, ElasticSearch for text search for vector embeddings, and Celery workers for asynchronous document processing. 

## Business Entities
- **User**: An authenticated identity in the system. 
- **Space**: A custom chat environment. One User (owner) can create and manage many Spaces.
- **SpaceMember**: A relational entity that connects specific Users to a Space to enforce Role-Based Access Control.
- **Conversation**: A chat thread belonging to a User, which can optionally be scoped to a specific Space.
- **Message**: A single interaction (user or assistant) belonging to one Conversation.
- **Upload**: Files (primarily PDFs) attached to a Space or Conversation for RAG. 
- **Domain Constraints**:
  - Uploaded documents must always be processed in the background by Celery workers to generate vector embeddings in Qdrant before being queryable.
  - Access to a Space is strictly governed by `SpaceMember` records or Space Ownership.
  - Use `Space` for custom contexts; never use synonyms like "Project" or "Gem". Use `Upload` for files, avoiding interchangeable use of "Attachment".

## Crucial Locations

### Frontend SPA (`frontend/src`)
- **Top-level Routing & Views**: `frontend/src/pages`
- **Reusable UI Components** (shadcn/Tailwind): `frontend/src/components/ui`
- **Domain UI Components**: `frontend/src/components/chat`, `frontend/src/components/spaces`
- **API Clients & API Calls**: `frontend/src/api`
- **State Management & Data Fetching Hooks** (Tanstack Query, Zustand): `frontend/src/hooks` and `frontend/src/store`

### Backend Application (`src/vvchat/app`)
- **Domain Models, DTOs & Interfaces (Ports)**: `src/vvchat/app/domain`
- **Business Logic & Use Cases**: `src/vvchat/app/application/services`
- **HTTP Endpoints & FastAPI Routes (Inbound)**: `src/vvchat/app/adapters/inbound/http`
- **Database Models & SQLAlchemy Repositories (Outbound)**: `src/vvchat/app/adapters/outbound/persistence/postgres`
- **Background Workers & Queues (Celery)**: `src/vvchat/app/adapters/outbound/tasks`
- **External API Integrations & LLM Triggers**: `src/vvchat/app/adapters/outbound/triggers`
- **Dependency Injection Setup (Dishka)**: `src/vvchat/app/di`
